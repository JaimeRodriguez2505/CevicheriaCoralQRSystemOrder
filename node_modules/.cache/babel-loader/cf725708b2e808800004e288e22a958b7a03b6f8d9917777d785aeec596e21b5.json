{"ast":null,"code":"import _objectSpread from\"/Users/soulkin/Documents/Cevicheria-Coral/Qr-Menu-Coral copy/CevicheriaCoralQRSystemOrder/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _createClass from\"/Users/soulkin/Documents/Cevicheria-Coral/Qr-Menu-Coral copy/CevicheriaCoralQRSystemOrder/node_modules/@babel/runtime/helpers/esm/createClass.js\";import _classCallCheck from\"/Users/soulkin/Documents/Cevicheria-Coral/Qr-Menu-Coral copy/CevicheriaCoralQRSystemOrder/node_modules/@babel/runtime/helpers/esm/classCallCheck.js\";import firebase from'firebase/compat/app';import'firebase/compat/auth';import'firebase/compat/database';var config={apiKey:process.env.REACT_APP_FIREBASE_KEY,appId:process.env.REACT_APP_FIREBASE_APP_ID,authDomain:process.env.REACT_APP_FIREBASE_DOMAIN,databaseURL:process.env.REACT_APP_FIREBASE_DATABASE,projectId:process.env.REACT_APP_FIREBASE_PROJECT_ID,messagingSenderId:process.env.REACT_APP_FIREBASE_SENDER_ID,storageBucket:process.env.REACT_APP_FIREBASE_STORAGE_BUCKET};var Firebase=/*#__PURE__*/_createClass(function Firebase(){var _this=this;_classCallCheck(this,Firebase);// Auth API\nthis.doCreateUserWithEmailAndPassword=function(email,password){return _this.auth.createUserWithEmailAndPassword(email,password);};this.doSignInWithEmailAndPassword=function(email,password){return _this.auth.signInWithEmailAndPassword(email,password);};this.doSignOut=function(){return _this.auth.signOut();};this.doPasswordReset=function(email){return _this.auth.sendPasswordResetEmail(email);};this.doPasswordUpdate=function(password){return _this.auth.currentUser.updatePassword(password);};// Merge Auth and DB User API\nthis.onAuthUserListener=function(next,fallback){return _this.auth.onAuthStateChanged(function(authUser){if(authUser){_this.user(authUser.uid).once('value').then(function(snapshot){var dbUser=snapshot.val();// merge auth and db user\nauthUser=_objectSpread({uid:authUser.uid,email:authUser.email,isAnonymous:authUser.isAnonymous},dbUser);next(authUser);});}else{fallback();}});};this.doSignInAnonymously=function(){return _this.auth.signInAnonymously();};// Cleanup Orders\nthis.cleanupDemoOrders=function(time){var keysToDelete=[];_this.db.ref(\"orders/\").once('value').then(function(snapshot){var orders=snapshot.val();for(var key in orders){if(orders[key].hasOwnProperty('timestamp')){if(time-orders[key][\"timestamp\"]>900000){keysToDelete.push(key);}}};}).then(function(){for(var i=0;i<keysToDelete.length;i++){_this.userOrders(keysToDelete[i]).remove();};});};// Cleanup Menu\nthis.cleanupDemoMenus=function(time){var keysToDelete=[];_this.db.ref(\"menus/\").once('value').then(function(snapshot){var menus=snapshot.val();for(var key in menus){if(menus[key].hasOwnProperty('timestamp')){if(time-menus[key][\"timestamp\"]>900000){keysToDelete.push(key);}}};}).then(function(){for(var i=0;i<keysToDelete.length;i++){_this.userMenu(keysToDelete[i]).remove();};});};// Cleanup Users\nthis.cleanupDemoUsers=function(time){var keysToDelete=[];_this.db.ref(\"users/\").once('value').then(function(snapshot){var users=snapshot.val();for(var key in users){if(users[key].hasOwnProperty('timestamp')){if(time-users[key][\"timestamp\"]>900000){keysToDelete.push(key);}}};}).then(function(){for(var i=0;i<keysToDelete.length;i++){_this.user(keysToDelete[i]).remove();};});};this.demoCleanupDb=function(){var currentTime=new Date().getTime();_this.cleanupDemoOrders(currentTime);_this.cleanupDemoMenus(currentTime);_this.cleanupDemoUsers(currentTime);};this.getCurrentUserUid=function(){return _this.auth.currentUser.uid;};this.getCurrentUser=function(){return _this.auth.currentUser;};// User API\nthis.users=function(){return _this.db.ref('users');};this.user=function(uid){return _this.db.ref(\"users/\".concat(uid));};this.userMenu=function(uid){return _this.db.ref(\"menus/\".concat(uid));};this.userOrders=function(uid){return _this.db.ref(\"orders/\".concat(uid));};this.userTables=function(uid){return _this.db.ref(\"users/\".concat(uid,\"/tables\"));};this.userBusinessName=function(uid){return _this.db.ref(\"users/\".concat(uid,\"/businessName\"));};firebase.initializeApp(config);this.auth=firebase.auth();this.db=firebase.database();});;export default Firebase;","map":{"version":3,"names":["firebase","config","apiKey","process","env","REACT_APP_FIREBASE_KEY","appId","REACT_APP_FIREBASE_APP_ID","authDomain","REACT_APP_FIREBASE_DOMAIN","databaseURL","REACT_APP_FIREBASE_DATABASE","projectId","REACT_APP_FIREBASE_PROJECT_ID","messagingSenderId","REACT_APP_FIREBASE_SENDER_ID","storageBucket","REACT_APP_FIREBASE_STORAGE_BUCKET","Firebase","_createClass","_this","_classCallCheck","doCreateUserWithEmailAndPassword","email","password","auth","createUserWithEmailAndPassword","doSignInWithEmailAndPassword","signInWithEmailAndPassword","doSignOut","signOut","doPasswordReset","sendPasswordResetEmail","doPasswordUpdate","currentUser","updatePassword","onAuthUserListener","next","fallback","onAuthStateChanged","authUser","user","uid","once","then","snapshot","dbUser","val","_objectSpread","isAnonymous","doSignInAnonymously","signInAnonymously","cleanupDemoOrders","time","keysToDelete","db","ref","orders","key","hasOwnProperty","push","i","length","userOrders","remove","cleanupDemoMenus","menus","userMenu","cleanupDemoUsers","users","demoCleanupDb","currentTime","Date","getTime","getCurrentUserUid","getCurrentUser","concat","userTables","userBusinessName","initializeApp","database"],"sources":["/Users/soulkin/Documents/Cevicheria-Coral/Qr-Menu-Coral copy/CevicheriaCoralQRSystemOrder/src/components/Firebase/firebase.js"],"sourcesContent":["import firebase from 'firebase/compat/app';\nimport 'firebase/compat/auth';\nimport 'firebase/compat/database';\n\nconst config = {\n  apiKey: process.env.REACT_APP_FIREBASE_KEY,\n  appId: process.env.REACT_APP_FIREBASE_APP_ID,\n  authDomain: process.env.REACT_APP_FIREBASE_DOMAIN,\n  databaseURL: process.env.REACT_APP_FIREBASE_DATABASE,\n  projectId: process.env.REACT_APP_FIREBASE_PROJECT_ID,\n  messagingSenderId: process.env.REACT_APP_FIREBASE_SENDER_ID,\n  storageBucket: process.env.REACT_APP_FIREBASE_STORAGE_BUCKET,\n};\n\nclass Firebase {\n  constructor() {\n    firebase.initializeApp(config);\n    this.auth = firebase.auth();\n    this.db = firebase.database();\n  }\n  // Auth API\n  doCreateUserWithEmailAndPassword = (email, password) =>\n    this.auth.createUserWithEmailAndPassword(email, password);\n\n  doSignInWithEmailAndPassword = (email, password) =>\n    this.auth.signInWithEmailAndPassword(email, password);\n\n  doSignOut = () => this.auth.signOut();\n\n  doPasswordReset = email => this.auth.sendPasswordResetEmail(email);\n\n  doPasswordUpdate = password =>\n    this.auth.currentUser.updatePassword(password);\n\n  // Merge Auth and DB User API\n  onAuthUserListener = (next, fallback) =>\n    this.auth.onAuthStateChanged(authUser => {\n      if (authUser) {\n        this.user(authUser.uid)\n          .once('value')\n          .then(snapshot => {\n            const dbUser = snapshot.val();\n            // merge auth and db user\n            authUser = {\n              uid: authUser.uid,\n              email: authUser.email,\n              isAnonymous: authUser.isAnonymous,\n              ...dbUser,\n            };\n            next(authUser);\n          });\n      } else {\n        fallback();\n      }\n    });\n\n  doSignInAnonymously = () =>\n    this.auth.signInAnonymously();\n\n  // Cleanup Orders\n  cleanupDemoOrders = (time) => {\n    let keysToDelete = [];\n    this.db.ref(`orders/`).once('value').then(snapshot => { \n      let orders = snapshot.val(); \n      for(var key in orders) {\n        if(orders[key].hasOwnProperty('timestamp')) {\n          if(time-orders[key][\"timestamp\"] > 900000) { \n            keysToDelete.push(key); \n          }\n        }\n      };\n    }).then(() => {\n      for(let i=0; i<keysToDelete.length; i++) { \n        this.userOrders(keysToDelete[i]).remove();\n      };\n    });\n  }\n\n  // Cleanup Menu\n  cleanupDemoMenus = (time) => {\n    let keysToDelete = [];\n    this.db.ref(`menus/`).once('value').then(snapshot => { \n      let menus = snapshot.val(); \n      for(var key in menus) {\n        if(menus[key].hasOwnProperty('timestamp')) {\n          if(time-menus[key][\"timestamp\"] > 900000) { \n            keysToDelete.push(key); \n          }\n        }\n      };\n    }).then(() => {\n      for(let i=0; i<keysToDelete.length; i++) { \n        this.userMenu(keysToDelete[i]).remove();\n      };\n    });\n  }\n\n  // Cleanup Users\n  cleanupDemoUsers = (time) => {\n    let keysToDelete = [];\n    this.db.ref(`users/`).once('value').then(snapshot => { \n      let users = snapshot.val(); \n      for(var key in users) {\n        if(users[key].hasOwnProperty('timestamp')) {\n          if(time-users[key][\"timestamp\"] > 900000) { \n            keysToDelete.push(key); \n          }\n        }\n      };\n    }).then(() => {\n      for(let i=0; i<keysToDelete.length; i++) { \n        this.user(keysToDelete[i]).remove();\n      };\n    });\n  }\n\n  demoCleanupDb = () => {\n    let currentTime = new Date().getTime();\n    this.cleanupDemoOrders(currentTime);  \n    this.cleanupDemoMenus(currentTime);  \n    this.cleanupDemoUsers(currentTime);\n  };\n\n  getCurrentUserUid = () => this.auth.currentUser.uid;\n  getCurrentUser = () => this.auth.currentUser;\n\n  // User API\n  users = () => this.db.ref('users');\n  user = uid => this.db.ref(`users/${uid}`);\n  userMenu = uid => this.db.ref(`menus/${uid}`);\n  userOrders = uid => this.db.ref(`orders/${uid}`);\n  userTables = uid => this.db.ref(`users/${uid}/tables`);\n  userBusinessName = uid => this.db.ref(`users/${uid}/businessName`);\n};\n\nexport default Firebase;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}